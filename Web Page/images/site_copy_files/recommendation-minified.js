Target.register("controller","recommendation",{catUrl:"",recommendationConfig:"",useRecommendationConfig:"",defMinVal:4,defMaxVal:4,urlParams:{},envUrls:{prod:"https://prz-secure.target.com/recommendations/v1",stg:"http://10.63.22.73:8080/recommendations/v1",qa:"http://10.63.22.70:8080/recommendations/v1"},placementNameMap:{},param:{productId:"",userId:"",min:"",max:"",visId:"",searchTerm:"",context:""},init:function(){var a=this,b=location.search||location.hash;window.recomTagData={};a.urlParams=
Target.controller.header.unSerialize(b);if(typeof recommendationConfig!=="undefined"&&!$.isEmptyObject(recommendationConfig)&&typeof useRecommendationConfig!=="undefined"&&useRecommendationConfig=="Y"){if(typeof recommendationConfig=="string")recommendationConfig=JSON.parse(recommendationConfig);a.recommendationConfig=recommendationConfig;a.catUrl=typeof a.urlParams.prz_env!="undefined"&&a.urlParams.prz_env!=""?a.envUrls[a.urlParams.prz_env]:recommendationConfig.serviceHostName?recommendationConfig.serviceHostName:
"";$.each(recommendationConfig.components,function(d,c){a._sendRequest(d,c)})}},_sendRequest:function(a,b){$.ajax({type:"GET",url:this._createUrl(this.catUrl,b,a),async:true,jsonpCallback:"jsonCallback",contentType:"application/json",dataType:"jsonp",timeout:1E4,success:function(){},error:function(){}})},_createUrl:function(a,b){var d=/\[CS]([^)]+)\[CE]/,c="",e="",f="",h=document.cookie.split(";"),g="";e=f=e="";f=Target.controller.header.cookie.read("s_vi")?Target.controller.header.cookie.read("s_vi"):
"";e=Target.controller.header.cookie.read("WC_PERSISTENT");for(var j=0;j<h.length;j++){g=h[j];if(g.indexOf("WC_USERACTIVITY_")!=-1)c=g.substring(g.indexOf("WC_USERACTIVITY_")+16,g.indexOf("="))}e=c===""?e:c;this.param.userId=e;this.param.visId=f!=""?f.match(d)[1].split("|")[1]:"";this.param.min=typeof b.min!="undefined"?b.min:this.defMinVal;this.param.max=typeof b.max!="undefined"?b.max:this.defMaxVal;if(typeof Target.globals.searchTerm!="undefined"&&Target.globals.searchTerm.searchTerm!=""){if(typeof String.prototype.trim!==
"function")String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};this.param.searchTerm=Target.globals.searchTerm.searchTerm.replace(/ {1,}/g," ").trim();this.param.searchTerm=encodeURI(this.param.searchTerm).replace(/%20/g,"+")}else delete this.param.searchTerm;f=typeof this.urlParams.prz_catid!="undefined"&&this.urlParams.prz_catid!=""?this.urlParams.prz_catid:typeof b.categoryId!="undefined"&&b.categoryId!==null&&b.categoryId!==""?b.categoryId:"";if(f!=="")f=";categoryId,"+f;if(typeof this.urlParams.prz_placement!=
"undefined"&&this.urlParams.prz_placement!=""){placements=this.urlParams.prz_placement.split("-");e=placements.length>1?placements[0]==b.placementName&&placements[1]!=""?placements[1]:b.placementName:b.placementName}else e=b.placementName;this.placementNameMap[e]=b.placementName;e="placementId,"+e;this.param.context=e+f;this.param.productId=typeof b.productId!="undefined"?b.productId:"";a+="?"+decodeURIComponent($.param(this.param));return a},recommendationRender:{placementOrder:{},CURRENCY_TYPE:"$",
strategyName:"",templateName:"",tagLink:"",productIndex:"",componentObj:{},currentComp:{},compContainerIds:{},verticalPlacements:["dlpv1","dlpv2","catbgv1","brandv1"],horizontalPlacements:["pdph1","plph1","slph1","nslph1","dlph1","ndlph1","pdp404h1","pdp404h2","a2ch1","cath770X250","catcombo3p770X507","catcombo4p770X477","catbgh1","awsmshoph1","pdp404awsmh1"],init:function(){this.loadInterface()},loadInterface:function(){},renderData:function(a,b){var d=this._getOrderConfig(b);window.recomTagData[b]=
this._getTagData(a)||{};this.templateName=b;this.strategyName=a.strategyName;this.currentComp=this.componentObj[b];this.placementOrder={};if($.inArray(b,this.verticalPlacements)!=-1)this.verticalCompRender(b,a,d);else $.inArray(b,this.horizontalPlacements)!=-1?this.horizontalCompRender(b,a,d):this[b](b,a,d)},verticalCompRender:function(a,b,d){this._verticalComponent(b,d,this.compContainerIds[a])},horizontalCompRender:function(a,b,d){this._horizontalComponent(b,d,this.compContainerIds[a])},pdpv1:function(a,
b,d){var c=this;if(b){var e=b.recommendations,f=e.length;if(typeof e!=="undefined"&&e){liHtml='<div class="pdpv1">';liHtml+='<h2 class="title">'+b.strategyDescription+"</h2>";liHtml+='<ul class="products-list component-carousel-2 loop paginationCount">';frameCount=4;count=countBack=0;$.each(e,function(h,g){c.productIndex=h+1;if(count===0||count%2===0){if(count===0)liHtml+='<li class="component-container liContainer2"><ul class="ulContainer2">';else if(count%2===0&&count>countBack)liHtml+='</ul></li><li class="component-container liContainer2"><ul class="ulContainer2">';
countBack=count}liHtml+=count%2!==0&&f===4?'<li class="product no-bottom-border">':'<li class="product">';liHtml+='<div class="product-container">';liHtml+=c._getProduct(g,d);liHtml+="</div>";liHtml+="</li>";count++});liHtml+="</ul></div>";$(c.compContainerIds[a]).html(liHtml);Target.controller.globalUtils.checkIfCarousal(".component-carousel-2")}}},_horizontalComponent:function(a,b,d){var c=this,e="",f=typeof c.currentComp.min!="undefined"&&c.currentComp.min!=0&&c.currentComp.min!=""?c.currentComp.min:
4,h="",g="";if(a){var j=a.recommendations,l=j.length;h=c.templateName==="awsmshoph1"||c.templateName==="pdp404awsmh1"?'<ul class="products-list">':'<ul class="products-list component-carousel-'+f+' loop paginationCount">';if(typeof j!=="undefined"&&j){e=l>f?"with-bottom-border":"";lihHtml='<div class="pdph1">';if(c.templateName==="awsmshoph1")lihHtml+='<div class="header1">';lihHtml+='<h2 class="title">'+(c.templateName!=="awsmshoph1"?a.strategyDescription:"")+(c.templateName==="pdp404awsmh1"||c.templateName===
"awsmshoph1"?"<a href='http://awesomeshop.target.com' class='logoLink' title='Target AwesomeShop'><span class='awesomeLogo'></span></a>":"")+"</h2>";if(c.templateName==="awsmshoph1"){lihHtml+='<p class="awesomeshopText'+e+'">';lihHtml+="Our top items in&nbsp;"+($(".search-large-text").html()!==null&&$(".search-large-text").html()!=="undefined"?$(".search-large-text").html():"&nbsp;this category");lihHtml+="</p>";lihHtml+="</div>"}lihHtml+=h;$.each(j,function(m,k){c.productIndex=m+1;g=c.templateName===
"awsmshoph1"||c.templateName==="pdp404awsmh1"?'<li class="product circle gradient">'+(k.rating==="5"?'<span class="label"><span class="labelText">highly reviewed</span></span>':""):'<li class="product component-container">';lihHtml+=g;lihHtml+='<div class="product-container '+e+'">';lihHtml+=c._getProduct(k,b);lihHtml+="</div>";lihHtml+="</li>"});lihHtml+="</ul></div>";$(d).removeClass("loading");$(d).html(lihHtml);Target.controller.globalUtils.checkIfCarousal(".component-carousel-"+f)}}},_verticalComponent:function(a,
b,d){var c=this;if(a){var e=a.recommendations;if(typeof e!=="undefined"&&e){liHtml='<div class="vertical">';liHtml+='<h2 class="title">'+a.strategyDescription+"</h2>";liHtml+='<ul class="products-list">';$.each(e,function(f,h){c.productIndex=f+1;liHtml+='<li class="product">';liHtml+='<div class="product-container">';liHtml+=c._getProduct(h,b);liHtml+="</div>";liHtml+="</li>"});liHtml+="</ul>";$(d).html(liHtml)}}},_getProduct:function(a,b){try{var d="",c=$.inArray("availMessage",b)!=-1?this._getAvailMsg(a):
"",e=$.inArray("qiLink",b)!=-1?this._getQILink(a):"",f={image:'<div class="image-container">'+this._getImage(a)+e+"</div>",qiLink:"",price:'<div class="price-container">'+this._getPrice(a)+"</div>",brand:this._getBrandName(a),title:'<div class="producttitle-container">'+this._getTitle(a,40)+"</div>",promotions:'<div class="product-promotions">'+this._getPromotions(a)+"</div>",availMessage:"",rating:'<div class="bottomContent">'+c+'<div class="product-rating">'+this._getReview(a)+"</div></div>"};for(c=
0;c<b.length;c++)d+=f[b[c]];return d}catch(h){}},_checkimage:function(){var a=a||"scene7.targetimg1.com";return window.location.protocol==="https:"?a.indexOf("scene7")>-1?"https://scene7-secure.targetimg1.com":"https://img1-secure.targetimg1.com":"http://"+a},_getImage:function(a){var b=a.productTitle,d=a.productImage,c=a.productLink,e="",f="",h="";f="";var g={};if(b)h=b.replace(/-quot-/g,'"');if(d.indexOf("scene7-secure.targetimg1.com")===-1&&useRecommendationConfig==="N"){e=this._checkimage();e+=
a.productImage}else e=d;this.tagLink="?lnk=rec|pdp|"+this.strategyName+"|"+this.templateName;f=e.indexOf("?")+1;g=Target.controller.header.unSerialize(e.substring(f));g.wid=g.hei=180;e=e.substring(0,f)+$.param(g);f=a.imageServer?'<a href="'+c+'" rel="nofollow" title="'+h+'">':'<a href="'+c+this.tagLink+'" rel="nofollow" title="'+h+'">';f+='<h3><img class="imgTag" original="'+e+'" alt="'+h+'" src="'+e+'" style="visibility: visible;"></h3>';f+="</a>";return f},_getQILink:function(a){var b=a.productTitle;
a=a.productId;var d="",c="";if(b)d=b.replace(/-quot-/g,'"');c+='<a href="/QuickInfoView?width=700&amp;partNumber='+a+"&amp;overlayId=QuickView&amp;lnk=Rec|qi|"+a+"|"+this.strategyName+"|"+this.templateName+'" rel="nofollow" class="layer qLink" onmousedown="" title="'+d+'">';c+='<div class="QILink"><span class="plus"> </span><span class="QIText">quick info</span><span class="screen-reader-only"> for '+b+" </span></div>";c+="</a>";return c},_getBrandName:function(a){var b="",d="";if(a=a.brand){d="/bp/"+
encodeURI(a).replace(/%20/g,"+");b='<a class="productBrand" href='+d+' title="'+a+'">'+a+"</a>"}return b},_getTitle:function(a,b){var d="";d=a.productTitle;var c=a.productLink,e="";e="";if(d){e=d.replace(/-quot-/g,'"');e=this._trimString(e,b);return d=a.imageServer?'<a href="'+c+'" title="'+d+'" class="waRRtag" rel="nofollow">'+e+"</a>":'<a href="'+c+this.tagLink+'" title="'+d+'" class="waRRtag" rel="nofollow">'+e+"</a>"}},_trimString:function(a,b){return a.length>b?a.substring(0,b)+"...":a},_getAvailMsg:function(a){var b=
"";if(["crossover","storeonly","online"][a.channel]==="storeonly"&&(a.soiPriceDisplay==="N"||a.soiPriceDisplay==="Y"))b="<div class='rr-instock'><span class='screen-reader-only'>available </span> in stores only</div>";return b},_getPrice:function(a){var b="",d="",c="",e="",f="",h=false,g=["crossover","storeonly","online"][a.channel];e="";var j=this.CURRENCY_TYPE;if(g==="storeonly")if(a.soiPriceDisplay==="N"&&(a.pickupInStore===""||a.pickupInStore==="N")){b="<div class='pricevarybystore'>see store for price</div>";
e=""}else{if(a.soiPriceDisplay==="Y"){b=this._getSalePrice(a);c="Store Price"}}else if(a.mapflag==="Y"&&(g==="online"||g==="crossover")){b=a.imageServer?"<a href='"+a.productLink+"' class='seelow'>see low price</a>":"<a href='"+a.productLink+this.tagLink+"' class='seelow'>see low price</a>";e=""}else if((parseFloat(a.mapPrice)>parseFloat(a.salePrice)||parseFloat(a.mapPrice)>parseFloat(a.salePriceMin)||parseFloat(a.mapPrice)>parseFloat(a.salePriceMax))&&(g==="online"||g==="crossover")){b="<a href='"+
a.productLink+this.tagLink+"' class='seelow'>see low price</a>";e=""}else if(parseFloat(a.listPrice)>parseFloat(a.regularPrice)&&(a.relationshipType==="VC"||a.relationshipType==="SA"||a.relationshipType==="TAC"||a.relationshipType==="CC"||a.relationshipType==="VAC")){h=true;if(a.salePrice!==""&&parseFloat(a.salePrice)<parseFloat(a.regularPrice)){b=j+a.salePrice;d=j+a.listPrice;f="<span class='screen-reader-only'>Save dollar</span> - save "+j+(parseFloat(a.listPrice)-parseFloat(a.salePrice)).toFixed(2)+
" ("+((parseFloat(a.listPrice)-parseFloat(a.salePrice))/parseFloat(a.listPrice)*100).toFixed(0)+")%"}else if(a.salePrice===""||a.salePrice===a.regularPrice){b=j+a.regularPrice;d=j+a.listPrice}}else b=a.salePriceMax!=""&&a.salePriceMin!=""?this._getSalePrice(a):j+a.salePrice;if(a.priceMax!=""&&a.priceMin!=""&&(a.priceMax!=a.salePriceMax||a.priceMin!=a.salePriceMin)&&(a.relationshipType==="VAP"||a.relationshipType==="VPC"||a.relationshipType==="COP"))d=a.priceMax!=a.priceMin?j+a.priceMin+" - "+j+a.priceMax:
a.priceMax==a.priceMin&&a.salePriceMin!=a.salePriceMax?j+a.priceMin:j+a.priceMin;else if(a.priceMax!==""&&a.priceMin!==""&&(a.priceMax!=a.salePriceMax||a.priceMin!=a.salePriceMin)&&(a.relationshipType==="VC"||a.relationshipType==="SA"||a.relationshipType==="TAC"||a.relationshipType==="CC"))d=a.priceMax!=a.priceMin?j+a.priceMin+" - "+j+a.priceMax:a.priceMax===a.priceMin&&a.salePriceMin!=a.salePriceMax?j+a.priceMin:j+a.listPrice;if(parseFloat(a.listPrice)>parseFloat(a.salePrice)&&a.priceMin===""&&a.priceMax===
""&&a.salePriceMin===""&&a.salePriceMax=="")d=j+a.listPrice;e+="<span class='salePrice'>"+b+"</span>";if(this.templateName!="awsmshoph1"&&this.templateName!="pdp404awsmh1"){if(c)e+="<div style='display:inline-block'><span class='storeprice'>"+c+"</span></div>";if(d)e+=h?"<p><span class=regprice>List: <span class='screen-reader-only'>List Price</span>"+d+f+"</span></p>":"<p><span class=regprice>reg: <span class='screen-reader-only'>Regular Price</span>"+d+"</span></p>"}return e},_getSalePrice:function(a){var b=
this.CURRENCY_TYPE;return salePrice=a.salePriceMax==a.salePriceMin?b+a.salePrice:b+a.salePriceMin+" - "+b+a.salePriceMax},_getReview:function(a){var b="";b=a.rating;var d="",c=["zero","one","two","three","four","five"],e=a.reviews?a.reviews:0,f=a.productTitle,h="",g="";h=a.productLink;g=a.imageServer?a.productReviewsLink:h+this.tagLink+'&amp;selectedTab=item-guestreviews-link""';if(b.indexOf(".")!=-1)d=(ratingTrim=b.substring(0,b.indexOf(".")))?c[ratingTrim]+"-half":"star-half";else if(b)d="stars-"+
b;h=typeof b!="undefined"&&b!=null&&b>0?"<span class='screen-reader-only'>Average rating for "+f+": "+b+" out of 5 stars</span>":"<span class='screen-reader-only'>there are no guest ratings for "+f+" </span>";return b=a.reviews&&a.reviews>0?'<div class="base-stars"> '+h+' <div class="display-rating '+d+'"></div></div>'+(this.templateName!=="pdp404awsmh1"&&this.templateName!=="awsmshoph1"?'<a class="waRRtag" rel="nofollow" title="'+f+'" href="'+g+'"><span class="screen-reader-only">See all </span><span>('+
e+')</span><span class="screen-reader-only"> reviews for '+f+"</span></a>":""):'<div class="base-stars"> '+h+' <div class="display-rating '+d+'"></div></div>'},_getPromotions:function(a){var b=this,d="",c=a.promoDescriptions;d='<ul class="promotionUl">';var e=0,f="";$.each(c,function(h,g){if(g!=""){f="";if(e==0)f='<span class="promoIcon"></span>';d+='<li class="promotionLi">'+f+'<span class="promoText" alt="'+c+'" title="'+c+'">'+b._trimString(g,38)+"</span></li>";e++}});d+="</ul>";return d},_getOrderConfig:function(a){var b=
this;!$.isEmptyObject(recommendationConfig)&&$.isEmptyObject(b.placementOrder)&&$.each(recommendationConfig.components,function(d,c){b.placementOrder[c.placementName]=c.placementOrder;b.componentObj[c.placementName]=c;b.compContainerIds[c.placementName]=typeof c.containerId!=="undefined"?c.containerId:""});return b.placementOrder[a]},_getTagData:function(a){return{doctype:typeof a.doctype!=="undefined"?a.doctype:"",strategyName:typeof a.strategyName!=="undefined"?a.strategyName:"",strategyId:typeof a.strategyId!==
"undefined"?a.strategyId:""}}}});recommedArr=[];function jsonCallback(a){try{if(a!=""){if(recommedArr[a.context.split(";")[0].split(",")[1]]=a){var b=JSON.stringify(a);placementName=JSON.parse(b).context.split(";")[0].split(",")[1];Target.controller.recommendation.recommendationRender.renderData(a,Target.controller.recommendation.placementNameMap[placementName])}}else for(i in recommedArr)i=="pdpv1"&&Target.controller.recommendation.recommendationRender.renderData(recommedArr[i],i)}catch(d){}};
